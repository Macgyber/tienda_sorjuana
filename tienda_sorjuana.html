<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TIENDA SORJUANA</title>
<style>
  /* --- Estilos simples, claros y responsivos --- */
  :root{
    --bg:#0f172a;           /* fondo profundo azul-oscuro */
    --card:#0b1220;         /* tarjetas */
    --accent:#22c55e;       /* verde moderno */
    --accent-2:#38bdf8;     /* celeste acento */
    --muted:#94a3b8;        /* texto secundario */
    --success:#22c55e;      /* verde para stock */
    --danger:#ef4444;       /* rojo para bajo stock */
    --glass: #3F1D38;      /* vidrio oscuro */
  }



  body{
     font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:linear-gradient(0deg, #E19898 , #A2678A, #4D3C77, #3F1D38);
    color:#e6eef8; 
    padding:20px;
    font-family:winter feast;
    font-size: 40px;
  }
  /* pantallas */
  .screen{display:none}

  .screen.active{display:block}

  .login{min-height:calc(100dvh - 40px);
    display:grid;
    place-items:center;
    padding:24px}
    
  .login-card{background:var(--card);
    padding:24px;
    border-radius:14px;
    box-shadow:0 12px 28px #aa6b9e;
    max-width:480px;
    width:100%;
    text-align:center;
   
  }

input{
  font-family:choco shake;
  font-size:16px
}

  .logo{
    margin-bottom:17px
    
  }
  .login h2{
    margin:10px 0 17px 0
  }
  .login form{
    display:flex
    ;flex-direction:column;
    gap:20px
  }
  .login input{padding:10px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.06);
    background:var(--glass);color:inherit
  }

  .login .muted{color:var(--muted);
    font-size:13px;
    margin-top:6px
  }
  header{
    display:flex;
    gap:16px;
    align-items:center;
    margin-bottom:18px}
  h1{
    margin:0;
    font-size:1.4rem}

    h2{
      font-family: hanging letters;
    }
  .wrap{
    display:grid;
    grid-template-columns:1fr 360px;
    gap:18px}
  .card{
    background:var(--card);
     padding:14px;
     border-radius:12px;
     box-shadow:0 8px 24px rgba(2,6,23,0.6)}
  .search{
    display:flex;
    gap:8px;
    margin-bottom:12px}

  input[type="search"]{
    flex:1;
    padding:8px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.04);
    background:var(--glass);
    color:inherit}

  .grid{
    display:flex;
    flex-direction:column;
    gap:8px}

  .product{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:10px;border-radius:10px;display:grid;grid-template-columns:56px minmax(0,1fr) minmax(140px,220px);gap:10px;align-items:center;transition:transform .18s ease, box-shadow .18s ease, opacity .18s ease}
  
    .product:hover{
    transform:translateY(-1px);
    box-shadow:0 10px 22px rgba(2,6,23,0.55)
  }

  .img{width:56px;
    height:56px;
    border-radius:8px;
  
    overflow:hidden}

  .info{display:flex;
    flex-direction:column;
    gap:2px;
    min-width:0}

  .title{font-weight:700; 
    margin:0;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis}
  .desc{
    margin:0;
    font-size:12px;
    color:var(--muted);
    line-height:1.3} 

  .meta{
    display:flex;
    gap:12px;
    font-size:13px;
    color:var(--muted)}

  button{
    background:linear-gradient(90deg,#3F1D38, #4D3C77 );
    border:none;
    padding:8px 12px;
    border-radius:10px;
    color:#ffffff;
    font-weight:800;
    cursor:pointer;
    transition:transform .12s ease, box-shadow .12s ease;
    min-width:0
  }

  button:hover{
    transform:translateY(-1px);
    box-shadow:0 6px 12px rgba(2,6,23,0.45)}

  button:focus-visible{
    outline:2px solid #93c5fd;
     outline-offset:2px}

  .small{font-size:13px;padding:6px 8px}

  .cart-list{display:flex;
    flex-direction:column;
    gap:8px}

  .cart-item{display:flex;
    gap:8px;
    align-items:center;
    justify-content:space-between}

  .qty{width:56px}

  footer{margin-top:16px;
    color:var(--muted);
    font-size:13px}

  .note{font-size:13px
    ;color:var(--muted);
    margin-bottom:8px}

  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  @keyframes fadeInUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  @media (prefers-reduced-motion: reduce){
    *{animation-duration:0.001ms !important;animation-iteration-count:1 !important;transition-duration:0.001ms !important;scroll-behavior:auto !important}
  }
  /* tooltip imagen */

  .tooltip{position:relative}
  .tooltip:hover .tooltip-card{opacity:1;transform:translateY(-4px);pointer-events:auto}
  .tooltip-card{position:absolute;top:-10px;left:68px;background:#0d1426;border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:6px;opacity:0;transform:translateY(0);transition:opacity .15s ease, transform .15s ease;box-shadow:0 14px 26px rgba(2,6,23,0.55);pointer-events:none;z-index:5}
  .tooltip-card img{display:block;border-radius:8px}

  /* acciones del carrito responsivas */

  .cart-actions{display:flex;gap:8px;flex-wrap:wrap}
  @media (max-width:720px){ .cart-actions button{flex:1 1 140px} }
  @media (max-width:420px){ .cart-actions button{flex:1 1 100%} }

  /* acciones de producto responsivas */

  .actions{display:flex;gap:6px;justify-content:flex-end;align-items:center;min-width:0;flex-wrap:nowrap}
  .actions .qty{flex:0 0 64px}
  .actions button{flex:0 1 auto;min-width:0;max-width:100%} 

  @media (max-width:1200px){ .actions{justify-content:flex-start;flex-wrap:wrap} .actions button{flex:1 1 160px} }
  @media (max-width:920px){ .actions{justify-content:flex-start;flex-wrap:wrap} .actions button{flex:1 1 160px} }
  @media (max-width:720px){ .actions button{flex:1 1 140px} }
  @media (max-width:420px){ .actions .qty{flex:0 0 44px} .actions button{flex:1 1 100%} }

  /* responsive */

  @media (max-width:920px){ .wrap{grid-template-columns:1fr} .card{margin-bottom:12px} .product{grid-template-columns:48px 1fr} .product > div:last-child{grid-column:1/-1;width:100%} }
  @media (max-width:720px){
    .product{grid-template-columns:48px 1fr}
    .img{width:48px;height:48px}
    .product > div:last-child{grid-column:1/-1;width:100%}
    .qty{width:50px}
    .tooltip-card{left:56px}
  }
  @media (max-width:420px){
    .desc{display:none}
    button{padding:6px 8px}
    .small{font-size:12px}
  }

</style>
</head>
<body>

<!-- Pantalla de Login -->
<header class="screen active" id="loginScreen">
  <div class="login">
    <div class="login-card" role="dialog" aria-labelledby="loginTitle" aria-describedby="loginDesc">
      <div class="logo" aria-hidden="true">
        <svg width="168" height="168" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#A2678A"/>
              <stop offset="100%" stop-color="#4D3C77"/>
            </linearGradient>
          </defs>
          <rect x="10" y="10" width="180" height="180" rx="28" fill="url(#g)"/>
          <path d="M60 85 h80 a10 10 0 0 1 10 10 v30 a10 10 0 0 1 -10 10 h-80 a10 10 0 0 1 -10 -10 v-30 a10 10 0 0 1 10 -10 z" fill="#E19898" opacity="0.2"/>
          <text x="100" y="110" text-anchor="middle" font-size="22" fill="white" font-family="winter feast" font-weight="700">SORJUANA</text>
          <text x="100" y="132" text-anchor="middle" font-size="14" fill="white" font-family="winter feast">TIENDA</text>
        </svg>
      </div>
      <h2 id="loginTitle">TIENDA SORJUANA</h2>
      <p id="loginDesc" class="muted">Inicia sesi√≥n para continuar.</p>
      <form id="loginForm">
        <input id="userName" type="text" placeholder="Nombre de usuario" required />
        <input id="userPass" type="password" placeholder="Contrase√±a" required />
        <label style="display:flex;gap:8px;align-items:center;justify-content:center;font-size:13px;color:var(--muted)">
          <input id="remember" type="checkbox" /> Recordarme en este dispositivo
        </label>
        <button id="ingresar" type="submit">Ingresar</button>
      </form>
      <div class="muted">Se guarda tu sesi√≥n en este dispositivo.</div>
    </div>
  </div>
</header>

<!-- App -->
<header id="appHeader" class="screen">
  <div>
    <h1>üõí TIENDA SORJUANA</h1>
    <div class="note">Aplicando lo aprendido: <strong>Objetos</strong>, <strong>arrays</strong>, <strong>funciones</strong>, <strong>par√°metros</strong>, <strong>condicionales</strong> y <strong>operadores l√≥gicos</strong>.</div>
  </div>
  <div style="margin-left:auto">
    <button id="logoutBtn" class="small" title="Cerrar sesi√≥n">Cerrar sesi√≥n</button>
  </div>
</header>

<div id="appMain" class="wrap screen">

  <!-- Panel principal: productos -->
  <main class="card">
    <div class="search">
      <input id="q" type="search" placeholder="Buscar por nombre, descripci√≥n o rango de precio (ej: 100-500)" />
      <button id="clear" class="small">Limpiar</button>
    </div>

    <div class="card" style="margin-bottom:12px">
      <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
        <div><strong>Filtros</strong> ‚Äî Usa l√≥gica: && || !</div>
        <div style="font-size:13px;color:var(--muted)">Stock alto: <input id="stockFilter" type="checkbox" /></div>
      </div>
      <div style="margin-top:8px;color:var(--muted);font-size:13px">
        Ejemplos: buscar "arroz", o "100-500" para rango de precio.
      </div>
    </div>

    <section id="products" class="grid" aria-label="Listado de productos en filas"></section>
  </main>

  <!-- Panel lateral: carrito / compra masiva -->
  <aside class="card">
    <h3>üßæ Carrito</h3>
    <div id="cartList" class="cart-list"></div>

    <div class="cart-actions" style="margin-top:10px">
      <button id="buyAll" class="small">Comprar todo</button>
      <button id="empty" class="small">Vaciar</button>
    </div>

    <div style="margin-top:12px">
      <div><strong>Total:</strong> <span id="total">0</span> COP</div>
      <div style="margin-top:8px;color:var(--muted);font-size:13px">
        El bot√≥n <em>Comprar todo</em> valida stock y aplica condiciones.
      </div>
      <div id="status" class="sr-only" aria-live="polite">Carrito: 0 productos, total 0</div>
    </div>

    <hr style="margin:12px 0;border:0;border-top:1px solid rgba(255,255,255,0.03)" />
    <div class="note">Entrega: sustenta lo aprendido mostrando funciones y estructuras en el c√≥digo.</div>
  </aside>

</div>

<footer id="appFooter" class="screen">
  <div>TIENDA SORJUANA ‚Äî Aplicando Objetos, Arrays, Funciones, Condicionales y Operadores L√≥gicos.</div>
</footer>

<script>
/* ===========================================================
   MIS DATOS - Array de objetos (lo que aprend√≠ en el periodo)
   Cada producto es un objeto con sus propiedades
   =========================================================== */

/* Funci√≥n para crear im√°genes simples sin archivos externos */
function svgDataURI(text, bg="#A7F3D0"){
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='240' height='160'>
    <rect width='100%' height='100%' fill='${bg}' rx='12'/>
    <text x='50%' y='50%' font-size='18' dominant-baseline='middle' text-anchor='middle' fill='#053039' font-family='sans-serif'>${escapeHtml(text)}</text>
  </svg>`
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg)
}
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) }

/* Mis productos - array de objetos como aprend√≠ */
const products = [
  { id:1, name:"Arroz 1 Kg", qty:25, price:2600, img: svgDataURI("Arroz 1Kg","#fde68a"), desc:"Arroz blanco calidad extra" },
  { id:2, name:"Aceite 900ml", qty:10, price:12000, img: svgDataURI("Aceite 900ml","#fca5a5"), desc:"Aceite vegetal para cocinar" },
  { id:3, name:"Leche 1L", qty:18, price:3500, img: svgDataURI("Leche 1L","#bfdbfe"), desc:"Leche entera" },
  { id:4, name:"Pan - unidad", qty:45, price:800, img: svgDataURI("Pan","#d1fae5"), desc:"Pan fresco del d√≠a" },
  { id:5, name:"Detergente 1L", qty:7, price:8500, img: svgDataURI("Detergente","#ffd6a5"), desc:"Detergente l√≠quido para ropa" },
  { id:6, name:"Huevos docena", qty:12, price:7800, img: svgDataURI("Huevos","#fde68a"), desc:"Huevos de gallina, docena" }
]

/* ===========================================================
   MI CARRITO - Objeto din√°mico que cambia
   =========================================================== */
const cart = {} // objeto vac√≠o que voy llenando con productos

/* Persistencia b√°sica en localStorage */
function saveCart(){
  try{
    const payload = JSON.stringify(cart)
    localStorage.setItem('ts_cart_v1', payload)
  }catch(e){
    console.warn('No se pudo guardar el carrito:', e)
  }
}
function loadCart(){
  try{
    const raw = localStorage.getItem('ts_cart_v1')
    if (!raw) return
    const data = JSON.parse(raw)
    if (typeof data !== 'object' || data === null) return
    // sanitizo: solo ids existentes y cantidades enteras >= 0
    Object.keys(data).forEach(k => {
      const id = Number(k)
      const qty = Number(data[k])
      const exists = products.some(p => p.id === id)
      if (exists && Number.isInteger(qty) && qty > 0){
        cart[id] = qty
      }
    })
  }catch(e){
    console.warn('No se pudo cargar el carrito:', e)
  }
}

/* ====== Login simple con persistencia ====== */
function showApp(){
  loginScreen.classList.remove('active')
  appHeader.classList.add('active')
  appMain.classList.add('active')
  appFooter.classList.add('active')
}
function showLogin(){
  loginScreen.classList.add('active')
  appHeader.classList.remove('active')
  appMain.classList.remove('active')
  appFooter.classList.remove('active')
}
function isLogged(){
  return localStorage.getItem('ts_logged') === '1'
}
function login(user, remember){
  if (remember){
    localStorage.setItem('ts_logged','1')
  } else {
    // sesi√≥n de una sola visita: usar sessionStorage
    sessionStorage.setItem('ts_logged','1')
  }
  localStorage.setItem('ts_user', user || '')
  showApp()
}
function logout(){
  localStorage.removeItem('ts_logged')
  localStorage.removeItem('ts_user')
  sessionStorage.removeItem('ts_logged')
  showLogin()
}

/* ===========================================================
   MIS FUNCIONES - Los 4 tipos que aprend√≠:
   - Tipo 1: sin par√°metros, sin retorno
   - Tipo 2: con par√°metros, sin retorno  
   - Tipo 3: sin par√°metros, con retorno
   - Tipo 4: con par√°metros y con retorno
   =========================================================== */

/* FUNCI√ìN TIPO 1: sin par√°metros, sin retorno */
function saludoTipo1(){
  // uso condicional if para verificar si el carrito est√° vac√≠o
  if (Object.keys(cart).length === 0) {
    console.log("¬°Hola! Bienvenido a mi tienda - tu carrito est√° vac√≠o")
  } else {
    console.log("¬°Gracias por comprar en mi tienda!")
  }
}

/* FUNCI√ìN TIPO 2: con par√°metros, sin retorno */
function addToCart(id, cantidad){
  // recibo par√°metros: id del producto y cantidad
  const p = products.find(x => x.id === id)
  if (!p) {
    alert("No encontr√© ese producto")
    return
  }
  // uso conectores l√≥gicos && y || para validar
  if (cantidad <= 0 || !Number.isInteger(cantidad)) {
    alert("La cantidad debe ser un n√∫mero entero mayor que 0")
    return
  }
  // si ya existe en el carrito, sumo; si no, lo agrego
  cart[id] = (cart[id] || 0) + cantidad
  // no retorno nada porque es tipo 2
  renderCart()
  renderProducts()
}

/* FUNCI√ìN TIPO 3: sin par√°metros, con retorno */
function getTotalTipo3(){
  // trabajo con mi objeto din√°mico cart
  const ids = Object.keys(cart).map(k => Number(k))
  const total = ids.reduce((acc, id) => {
    const p = products.find(x => x.id===id)
    if (!p) return acc
    return acc + (p.price * cart[id])
  }, 0)
  return total // retorno el total calculado
}

/* FUNCI√ìN TIPO 4: con par√°metros y con retorno */
function formatPriceTipo4(price, currency="COP"){
  // recibo par√°metros: precio y moneda
  // uso condicional if para validar
  if (typeof price !== "number") return "0 " + currency
  // formateo el precio y lo retorno
  const formatted = price.toLocaleString('es-CO')
  return `${formatted} ${currency}`
}

/* ===========================================================
   MIS OTRAS FUNCIONES - Uso condicionales y operadores l√≥gicos
   =========================================================== */

const productsEl = document.getElementById('products')
const cartListEl = document.getElementById('cartList')
const totalEl = document.getElementById('total')
const qInput = document.getElementById('q')
const clearBtn = document.getElementById('clear')
const stockFilter = document.getElementById('stockFilter')
const loginScreen = document.getElementById('loginScreen')
const appHeader = document.getElementById('appHeader')
const appMain = document.getElementById('appMain')
const appFooter = document.getElementById('appFooter')

function renderProducts(){
  // leo lo que escribi√≥ el usuario
  const q = qInput.value.trim().toLowerCase()
  const stockOnly = stockFilter.checked

  // filtro mis productos usando condicionales y operadores l√≥gicos
  const filtered = products.filter(p => {
    // si quiere solo stock alto, verifico que tenga >= 10
    if (stockOnly && !(p.qty >= 10)) return false
    if (!q) return true

    // si escribi√≥ algo como "100-500" busco por rango de precio
    if (q.includes('-')){
      const [a,b] = q.split('-').map(s => Number(s.trim())).filter(n => !Number.isNaN(n))
      if (a && b) {
        // uso operadores l√≥gicos && para verificar rango
        return p.price >= a && p.price <= b
      }
    }

    // busco en nombre o descripci√≥n usando ||
    return p.name.toLowerCase().includes(q) || p.desc.toLowerCase().includes(q)
  })

  // render
  productsEl.innerHTML = ''
  filtered.forEach(p => {
    const el = document.createElement('div')
    el.className = 'product'
    el.innerHTML = `
      <div class="img tooltip">
        <img src="${p.img}" alt="${escapeHtml(p.name)}" width="56" height="56"/>
        <div class="tooltip-card">
          <img src="${p.img}" alt="${escapeHtml(p.name)}" width="180" height="120"/>
        </div>
      </div>
      <div class="info">
        <div class="title">${escapeHtml(p.name)}</div>
        <div class="desc">${escapeHtml(p.desc)}</div>
        <div class="meta">
          <div>${formatPriceTipo4(p.price)}</div>
          <div style="color:${p.qty>0?'#bde5c5':'#fda4af'}">${p.qty} en stock</div>
        </div>
      </div>
      <div class="actions">
        <input data-id="${p.id}" class="qty" type="number" min="1" value="1" />
        <button data-add="${p.id}" class="small">Agregar</button>
        <button data-view="${p.id}" class="small" title="Ver detalle">Detalle</button>
      </div>
    `
    // animaci√≥n de entrada
    el.style.animation = 'fadeInUp .36s ease both'
    productsEl.appendChild(el)
  })

  // conecto los botones con mis funciones
  productsEl.querySelectorAll('button[data-add]').forEach(b=>{
    b.onclick = e=>{
      const id = Number(b.getAttribute('data-add'))
      const input = productsEl.querySelector(`input[data-id="${id}"]`)
      const cantidad = Number(input.value) || 1
      addToCart(id, cantidad) // llamo mi funci√≥n tipo 2
      saludoTipo1() // llamo mi funci√≥n tipo 1
    }
  })
  productsEl.querySelectorAll('button[data-view]').forEach(b=>{
    b.onclick = e=>{
      const id = Number(b.getAttribute('data-view'))
      const p = products.find(x=>x.id===id)
      if (!p) return
      alert(`${p.name}\n\n${p.desc}\nPrecio: ${formatPriceTipo4(p.price)}\nStock: ${p.qty}`)
    }
  })
}

function renderCart(){
  cartListEl.innerHTML = ''
  const ids = Object.keys(cart).map(k=>Number(k))
  if (ids.length === 0){
    cartListEl.innerHTML = `<div style="color:var(--muted)">El carrito est√° vac√≠o.</div>`
  } else {
    ids.forEach(id=>{
      const p = products.find(x=>x.id===id)
      if (!p) return
      const item = document.createElement('div')
      item.className = 'cart-item'
      item.innerHTML = `
        <div style="display:flex;gap:8px;align-items:center">
          <div style="width:40px;height:40px;border-radius:6px;overflow:hidden"><img src="${p.img}" width="40" height="40"/></div>
          <div style="min-width:140px">
            <div style="font-weight:700">${escapeHtml(p.name)}</div>
            <div style="font-size:13px;color:var(--muted)">${formatPriceTipo4(p.price)}</div>
          </div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <input data-cart-id="${id}" class="qty" type="number" min="0" value="${cart[id]}" style="width:64px" />
          <div style="min-width:70px;text-align:right">${formatPriceTipo4(p.price * cart[id])}</div>
          <button data-remove="${id}" class="small">Quitar</button>
        </div>
      `
      cartListEl.appendChild(item)
    })

    // eventos: cambiar cantidad y quitar
    cartListEl.querySelectorAll('input[data-cart-id]').forEach(inp=>{
      inp.onchange = ()=>{
        const id = Number(inp.getAttribute('data-cart-id'))
        let val = Number(inp.value)
        if (!Number.isInteger(val) || val < 0) val = 0
        if (val === 0) delete cart[id]
        else cart[id] = val
        renderCart()
        renderProducts()
      }
    })
    cartListEl.querySelectorAll('button[data-remove]').forEach(btn=>{
      btn.onclick = ()=> {
        const id = Number(btn.getAttribute('data-remove'))
        delete cart[id]
        renderCart()
        renderProducts()
      }
    })
  }

  // actualizo el total usando mis funciones tipo 3 y 4
  const total = getTotalTipo3()
  totalEl.textContent = formatPriceTipo4(total)
  const statusEl = document.getElementById('status')
  if (statusEl){
    const idsCount = Object.keys(cart).length
    statusEl.textContent = `Carrito: ${idsCount} ${idsCount===1?'producto':'productos'}, total ${formatPriceTipo4(total)}`
  }
  saveCart()
}

/* Funci√≥n para comprar todo - uso muchos condicionales */
function comprarTodo(){
  const ids = Object.keys(cart).map(k=>Number(k))
  if (ids.length === 0){
    alert("Tu carrito est√° vac√≠o")
    return
  }

  // verifico que haya stock suficiente
  const errors = []
  ids.forEach(id=>{
    const p = products.find(x=>x.id===id)
    const want = cart[id] || 0
    // uso condicionales if y else if
    if (!p) errors.push(`No encontr√© el producto ${id}`)
    else if (want > p.qty) errors.push(`${p.name}: no hay suficiente (quieres ${want}, tengo ${p.qty})`)
  })

  // si hay errores, no compro
  if (errors.length > 0){
    alert("No puedo completar la compra:\n\n" + errors.join("\n"))
    return
  }

  // pregunto si est√° seguro
  const total = getTotalTipo3()
  const ok = confirm(`Total: ${formatPriceTipo4(total)}\n¬øConfirmar compra?`)
  if (!ok) return

  // descuento del stock
  ids.forEach(id=>{
    const p = products.find(x=>x.id===id)
    p.qty -= cart[id]
    if (p.qty < 0) p.qty = 0
  })

  // vac√≠o el carrito
  for (const k of Object.keys(cart)) delete cart[k]

  renderCart()
  renderProducts()
  alert("¬°Compra exitosa! Gracias por comprar en mi tienda üõí")
}

/* ===========================================================
   CONECTO LOS BOTONES CON MIS FUNCIONES
   =========================================================== */
document.getElementById('buyAll').onclick = comprarTodo
document.getElementById('empty').onclick = ()=>{
  for (const k of Object.keys(cart)) delete cart[k]
  renderCart()
  renderProducts()
}
clearBtn.onclick = ()=>{ qInput.value=''; renderProducts() }
qInput.oninput = debounce(()=> renderProducts(), 300)
stockFilter.onchange = ()=> renderProducts()

/* ===========================================================
   FUNCI√ìN AUXILIAR PARA EL BUSCADOR
   =========================================================== */
function debounce(fn, wait=200){
  let t
  return (...args)=>{
    clearTimeout(t)
    t = setTimeout(()=> fn.apply(this, args), wait)
  }
}

/* ===========================================================
   INICIO MI APLICACI√ìN
   =========================================================== */
// Mostrar pantalla correcta seg√∫n sesi√≥n
// Si hay sesi√≥n guardada en localStorage o sessionStorage, entra directo
if (isLogged() || sessionStorage.getItem('ts_logged') === '1'){
  showApp()
} else {
  showLogin()
}
// Login submit (usuario fijo: eve / 1234)
const loginForm = document.getElementById('loginForm')
if (loginForm){
  loginForm.addEventListener('submit', (e)=>{
    e.preventDefault()
    const user = document.getElementById('userName').value.trim()
    const pass = document.getElementById('userPass').value.trim()
    const remember = document.getElementById('remember').checked
    if (!user || !pass){ alert('Completa usuario y contrase√±a'); return }
    if (user !== 'eve' || pass !== '1234'){
      alert('Credenciales inv√°lidas. Usuario: eve  Contrase√±a: 1234')
      return
    }
    login(user, remember)
  })
}

// bot√≥n cerrar sesi√≥n
const logoutBtn = document.getElementById('logoutBtn')
if (logoutBtn){ logoutBtn.onclick = logout }

loadCart()
renderProducts()
renderCart()

/* -----------------------------------------------------------
   LO QUE APREND√ç EN EL PERIODO 3:
   ‚úÖ Objetos: cada producto es un objeto con propiedades
   ‚úÖ Arrays: lista de productos y m√©todos como filter, forEach
   ‚úÖ Estructuras din√°micas: objeto cart que cambia
   ‚úÖ Funciones tipo 1-4: todas implementadas y usadas
   ‚úÖ Par√°metros: funciones que reciben datos
   ‚úÖ Condicionales: if, else, operadores ternarios
   ‚úÖ Conectores l√≥gicos: &&, ||, ! en validaciones
   ----------------------------------------------------------- */

</script>


</section>
</body>
</html>
